<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>goAML Report - Expandable Tree</title>
  <style>
    body {
      background-color: #f0f4f8;
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 20px;
      color: #2c3e50;
    }

    h1 {
      color: #1a73e8;
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: 600;
    }

    .tree ul {
      list-style-type: none;
      padding-left: 20px;
    }

    .tree li {
      margin: 8px 0;
      position: relative;
      transition: all 0.2s ease;
    }

    .tree li.has-children::before {
      content: "▶";
      margin-right: 8px;
      cursor: pointer;
      color: #4285f4;
      font-size: 12px;
      transition: transform 0.2s ease;
    }

    .tree li.has-children.open::before {
      content: "▼";
      transform: rotate(90deg);
    }

    .tree ul.hidden {
      display: none;
    }

    .tree li {
      font-size: 14px;
      line-height: 1.5;
    }

    .tree .label {
      font-weight: 600;
      color: #1a73e8;
      cursor: pointer;
      position: relative;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background-color 0.2s ease;
    }

    .tree .label:hover {
      background-color: #e8f0fe;
    }

    .tree .value {
      color: #5f6368;
      font-weight: normal;
    }

    .tree .label:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      background: #1a73e8;
      color: #ffffff;
      padding: 6px 12px;
      border-radius: 4px;
      top: -35px;
      left: 0;
      white-space: nowrap;
      z-index: 10;
      font-size: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .lookup-values {
      display: none;
      background: #e8f0fe;
      padding: 8px;
      margin-top: 5px;
      border-radius: 4px;
      border: 1px solid #d2e3fc;
      font-size: 12px;
      color: #174ea6;
    }

    .lookup-values ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    .lookup-values li {
      margin: 4px 0;
      padding-left: 10px;
      position: relative;
    }

    .lookup-values li::before {
      content: "•";
      position: absolute;
      left: 0;
      color: #4285f4;
    }

    .tree ul {
      transition: max-height 0.3s ease;
    }

    .tree ul.hidden {
      max-height: 0;
      overflow: hidden;
    }

    .tree ul:not(.hidden) {
      max-height: 1000px;
    }
  </style>
</head>
<body>
  <h1>goAML Suspicious Transaction Report</h1>
  <div id="tree" class="tree"></div>

  <script>
    const fieldDictionary = {
      "rentity_id": {
        description: "Unique identifier of the reporting entity assigned by the FIU (e.g., FIU-DE-001).",
        lookup_values: null
      },
      "rentity_branch": {
        description: "Branch of the reporting entity submitting the report, if applicable.",
        lookup_values: null
      },
      "submission_date": {
        description: "Date when the report is submitted to the FIU (format: YYYY-MM-DD).",
        lookup_values: null
      },
      "report_id": {
        description: "Unique identifier for the report, generated by the reporting entity (e.g., STR-2025-0001).",
        lookup_values: null
      },
      "report_type": {
        description: "Type of report being submitted, as defined in the goAML schema.",
        lookup_values: [
          { code: "STR", description: "Suspicious Transaction Report" },
          { code: "CTR", description: "Currency Transaction Report" },
          { code: "EFT", description: "Electronic Funds Transfer Report" },
          { code: "IFT", description: "International Funds Transfer Report" },
          { code: "TFR", description: "Terrorist Financing Report" },
          { code: "BCR", description: "Border Cash Report" },
          { code: "UTR", description: "Unusual Transaction Report" },
          { code: "AIF", description: "Additional Information File" },
          { code: "IRI", description: "Incoming Request for Information" },
          { code: "ORI", description: "Outgoing Request for Information" },
          { code: "IRD", description: "Incoming Response to a Request" },
          { code: "ORD", description: "Outgoing Response to a Request" }
        ]
      },
      "priority": {
        description: "Priority level of the report, indicating urgency (e.g., High, Medium, Low).",
        lookup_values: [
          { code: "High", description: "High Priority" },
          { code: "Medium", description: "Medium Priority" },
          { code: "Low", description: "Low Priority" }
        ]
      },
      "submission_type": {
        description: "Method of report submission, as defined in the goAML schema.",
        lookup_values: [
          { code: "E", description: "Electronically" },
          { code: "M", description: "Manually" }
        ]
      },
      "reporting_date": {
        description: "Date when the suspicious activity was identified (format: YYYY-MM-DD).",
        lookup_values: null
      },
      "legal_basis": {
        description: "Legal basis for submitting the report, referencing German AML law (e.g., GwG § 43).",
        lookup_values: null
      },
      "comments": {
        description: "Additional comments or notes about the report, providing context or details.",
        lookup_values: null
      },
      "first_name": {
        description: "First name of the person (e.g., reporting person or party involved).",
        lookup_values: null
      },
      "last_name": {
        description: "Last name of the person (e.g., reporting person or party involved).",
        lookup_values: null
      },
      "title": {
        description: "Professional title of the reporting person (e.g., Compliance Officer).",
        lookup_values: null
      },
      "phone": {
        description: "Phone number of the person (format: +[country code][number], e.g., +493012345678).",
        lookup_values: null
      },
      "email": {
        description: "Email address of the person (e.g., compliance@bank.de).",
        lookup_values: null
      },
      "t_number": {
        description: "Unique identifier for the transaction, generated by the reporting entity (e.g., TX-001).",
        lookup_values: null
      },
      "t_date_time": {
        description: "Date and time of the transaction (format: YYYY-MM-DDThh:mm:ss).",
        lookup_values: null
      },
      "amount_local": {
        description: "Transaction amount in local currency (e.g., 10000.00).",
        lookup_values: null
      },
      "currency": {
        description: "Currency code for the local amount (ISO 4217, e.g., EUR).",
        lookup_values: [
          { code: "EUR", description: "Euro" },
          { code: "USD", description: "United States Dollar" },
          { code: "CHF", description: "Swiss Franc" },
          { code: "GBP", description: "British Pound Sterling" },
          { code: "JPY", description: "Japanese Yen" },
          { code: "AUD", description: "Australian Dollar" },
          { code: "CAD", description: "Canadian Dollar" },
          { code: "CNY", description: "Chinese Yuan" }
        ]
      },
      "amount_foreign": {
        description: "Transaction amount in foreign currency, if applicable (e.g., 10850.00).",
        lookup_values: null
      },
      "foreign_currency": {
        description: "Currency code for the foreign amount (ISO 4217, e.g., CHF).",
        lookup_values: [
          { code: "EUR", description: "Euro" },
          { code: "USD", description: "United States Dollar" },
          { code: "CHF", description: "Swiss Franc" },
          { code: "GBP", description: "British Pound Sterling" },
          { code: "JPY", description: "Japanese Yen" },
          { code: "AUD", description: "Australian Dollar" },
          { code: "CAD", description: "Canadian Dollar" },
          { code: "CNY", description: "Chinese Yuan" }
        ]
      },
      "exchange_rate": {
        description: "Exchange rate used for conversion between local and foreign currency (e.g., 1.085).",
        lookup_values: null
      },
      "t_type": {
        description: "Type of transaction, as defined in the goAML schema.",
        lookup_values: [
          { code: "WIRE", description: "Wire Transfer" },
          { code: "CASHDEP", description: "Cash Deposit" },
          { code: "CASHWDL", description: "Cash Withdrawal" },
          { code: "CHECK", description: "Check Payment" },
          { code: "TRANSFER", description: "Internal Transfer" },
          { code: "ACH", description: "Automated Clearing House Transfer" },
          { code: "CARD", description: "Credit/Debit Card Transaction" }
        ]
      },
      "direction": {
        description: "Direction of the transaction (Incoming or Outgoing).",
        lookup_values: [
          { code: "Incoming", description: "Funds received" },
          { code: "Outgoing", description: "Funds sent" }
        ]
      },
      "description": {
        description: "Description of the transaction or activity, providing details of the suspicion.",
        lookup_values: null
      },
      "account_number": {
        description: "Account number associated with the transaction or party (e.g., DE89370400440532013000).",
        lookup_values: null
      },
      "institution_name": {
        description: "Name of the financial institution holding the account (e.g., Deutsche Bank AG).",
        lookup_values: null
      },
      "iban": {
        description: "International Bank Account Number (IBAN) of the account (e.g., DE89370400440532013000).",
        lookup_values: null
      },
      "account_type": {
        description: "Type of account, as defined in the goAML schema.",
        lookup_values: [
          { code: "A", description: "Business" },
          { code: "B", description: "Personal Current" },
          { code: "C", description: "Savings" },
          { code: "D", description: "Trust Account" },
          { code: "E", description: "Trading Account" },
          { code: "O", description: "Other" }
        ]
      },
      "gender": {
        description: "Gender of the person, as defined in the goAML schema.",
        lookup_values: [
          { code: "M", description: "Male" },
          { code: "F", description: "Female" },
          { code: "O", description: "Other" }
        ]
      },
      "nationality": {
        description: "Nationality of the person (ISO 3166-1 alpha-2 code, e.g., DE).",
        lookup_values: [
          { code: "DE", description: "Germany" },
          { code: "CH", description: "Switzerland" },
          { code: "US", description: "United States" },
          { code: "GB", description: "United Kingdom" },
          { code: "JP", description: "Japan" },
          { code: "AU", description: "Australia" },
          { code: "CA", description: "Canada" },
          { code: "CN", description: "China" }
        ]
      },
      "birth_date": {
        description: "Date of birth of the person (format: YYYY-MM-DD, e.g., 1985-06-15).",
        lookup_values: null
      },
      "id_number": {
        description: "Identification number of the person (e.g., T123456789).",
        lookup_values: null
      },
      "id_type": {
        description: "Type of identification document, as defined in the goAML schema.",
        lookup_values: [
          { code: "A", description: "Driver's License" },
          { code: "B", description: "Identity Card" },
          { code: "C", description: "Passport" },
          { code: "O", description: "Other" }
        ]
      },
      "issue_country": {
        description: "Country that issued the identification document (ISO 3166-1 alpha-2 code, e.g., DE).",
        lookup_values: [
          { code: "DE", description: "Germany" },
          { code: "CH", description: "Switzerland" },
          { code: "US", description: "United States" },
          { code: "GB", description: "United Kingdom" },
          { code: "JP", description: "Japan" },
          { code: "AU", description: "Australia" },
          { code: "CA", description: "Canada" },
          { code: "CN", description: "China" }
        ]
      },
      "street": {
        description: "Street name of the address (e.g., Hauptstraße 10).",
        lookup_values: null
      },
      "city": {
        description: "City of the address (e.g., Berlin).",
        lookup_values: null
      },
      "zip": {
        description: "Postal code of the address (e.g., 10115).",
        lookup_values: null
      },
      "country": {
        description: "Country of the address (ISO 3166-1 alpha-2 code, e.g., DE).",
        lookup_values: [
          { code: "DE", description: "Germany" },
          { code: "CH", description: "Switzerland" },
          { code: "US", description: "United States" },
          { code: "GB", description: "United Kingdom" },
          { code: "JP", description: "Japan" },
          { code: "AU", description: "Australia" },
          { code: "CA", description: "Canada" },
          { code: "CN", description: "China" }
        ]
      },
      "activity_id": {
        description: "Unique identifier for the activity, generated by the reporting entity (e.g., ACT-2025-0001).",
        lookup_values: null
      },
      "activity_type": {
        description: "Type of activity being reported, as defined in the goAML schema.",
        lookup_values: [
          { code: "Suspicious Transaction", description: "Suspicious Transaction Activity" },
          { code: "Terrorist Financing", description: "Terrorist Financing Activity" },
          { code: "Money Laundering", description: "Money Laundering Activity" },
          { code: "Fraud", description: "Fraudulent Activity" }
        ]
      },
      "start_date": {
        description: "Start date of the activity (format: YYYY-MM-DD, e.g., 2025-03-20).",
        lookup_values: null
      },
      "end_date": {
        description: "End date of the activity (format: YYYY-MM-DD, e.g., 2025-03-23).",
        lookup_values: null
      },
      "role": {
        description: "Role of the party in the activity, as defined in the goAML schema.",
        lookup_values: [
          { code: "Client", description: "Client of the reporting entity" },
          { code: "Counterparty", description: "Counterparty in the transaction" },
          { code: "Depositor", description: "Person making a deposit" },
          { code: "Beneficiary", description: "Beneficiary of the transaction" },
          { code: "Agent", description: "Agent acting on behalf of a party" }
        ]
      },
      "name": {
        description: "Name of the organization (e.g., Swiss Trading GmbH).",
        lookup_values: null
      },
      "registration_number": {
        description: "Registration number of the organization (e.g., CHE-123.456.789).",
        lookup_values: null
      },
      "registration_country": {
        description: "Country where the organization is registered (ISO 3166-1 alpha-2 code, e.g., CH).",
        lookup_values: [
          { code: "DE", description: "Germany" },
          { code: "CH", description: "Switzerland" },
          { code: "US", description: "United States" },
          { code: "GB", description: "United Kingdom" },
          { code: "JP", description: "Japan" },
          { code: "AU", description: "Australia" },
          { code: "CA", description: "Canada" },
          { code: "CN", description: "China" }
        ]
      },
      "transaction_ref": {
        description: "Reference to a transaction ID within the activity (e.g., TX-001).",
        lookup_values: null
      },
      "indicator": {
        description: "Suspicion indicator code as defined in goAML schema Section 5.18, describing the reason for suspicion.",
        lookup_values: [
          { code: "A1000", description: "Money laundering" },
          { code: "A1001", description: "Transaction in connection with money laundering (FIU approval required, §46 par 1)" },
          { code: "A1002", description: "Transaction in connection with money laundering (respite not possible, §46 par 2)" },
          { code: "A1003", description: "Transaction in connection with money laundering (subsequent finding, §46 par 2)" },
          { code: "A1004", description: "Business connection in connection with money laundering" },
          { code: "A1005", description: "Brokerage in connection with money laundering" },
          { code: "A2000", description: "Terrorist financing" },
          { code: "A2001", description: "Transaction in connection with terrorist financing (FIU approval required, §46 par 1)" },
          { code: "A2002", description: "Transaction in connection with terrorist financing (respite not possible, §46 par 2)" },
          { code: "A2003", description: "Transaction in connection with terrorist financing (subsequent finding, §46 par 2)" },
          { code: "A3000", description: "Fraud" },
          { code: "A4000", description: "Other predicate offense" },
          { code: "A5000", description: "Other suspicious activity" }
        ]
      },
      "branch_name": {
        description: "Name of the branch where the transaction occurred (e.g., Deutsche Bank Berlin Mitte).",
        lookup_values: null
      }
    };

    const xmlString = `<?xml version="1.0" encoding="UTF-8"?>
<goaml xmlns="http://www.goaml.org/schema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.goaml.org/schema goAMLSchema.xsd">
  <report>
    <rentity_id>FIU-DE-001</rentity_id>
    <rentity_branch>Berlin Branch</rentity_branch>
    <submission_date>2025-03-25</submission_date>
    <report_id>STR-2025-0001</report_id>
    <report_type>STR</report_type>
    <priority>High</priority>
    <submission_type>E</submission_type>
    <reporting_date>2025-03-24</reporting_date>
    <legal_basis>GwG § 43</legal_basis>
    <comments>Suspicious activity detected in cross-border transactions</comments>
    <reporting_person>
      <first_name>Thomas</first_name>
      <last_name>Müller</last_name>
      <title>Compliance Officer</title>
      <phone>+493012345678</phone>
      <email>thomas.mueller@bank.de</email>
    </reporting_person>
    <transaction>
      <t_number>TX-001</t_number>
      <t_date_time>2025-03-20T14:30:00</t_date_time>
      <amount_local>10000.00</amount_local>
      <currency>EUR</currency>
      <amount_foreign>10850.00</amount_foreign>
      <foreign_currency>CHF</foreign_currency>
      <exchange_rate>1.085</exchange_rate>
      <t_type>WIRE</t_type>
      <direction>Outgoing</direction>
      <t_from_my_client>
        <first_name>Anna</first_name>
        <last_name>Schmidt</last_name>
        <gender>F</gender>
        <nationality>DE</nationality>
        <birth_date>1985-06-15</birth_date>
        <identification>
          <id_number>T123456789</id_number>
          <id_type>O</id_type>
          <issue_country>DE</issue_country>
        </identification>
        <address>
          <street>Hauptstraße 10</street>
          <city>Berlin</city>
          <zip>10115</zip>
          <country>DE</country>
        </address>
        <account_number>DE89370400440532013000</account_number>
        <institution_name>Deutsche Bank AG</institution_name>
        <iban>DE89370400440532013000</iban>
        <account_type>B</account_type>
      </t_from_my_client>
      <t_to>
        <to_account>
          <account_number>CH12345678901234567890</account_number>
          <institution_name>UBS Switzerland AG</institution_name>
          <iban>CH12345678901234567890</iban>
          <account_type>A</account_type>
        </to_account>
      </t_to>
      <description>Payment for consulting services</description>
    </transaction>
    <transaction>
      <t_number>TX-002</t_number>
      <t_date_time>2025-03-21T09:15:00</t_date_time>
      <amount_local>5000.00</amount_local>
      <currency>EUR</currency>
      <t_type>CASHDEP</t_type>
      <direction>Incoming</direction>
      <t_from>
        <from_person>
          <first_name>Unknown</first_name>
          <last_name>Cash Depositor</last_name>
        </from_person>
      </t_from>
      <t_to_my_account>
        <account_number>DE89370400440532013000</account_number>
        <institution_name>Deutsche Bank AG</institution_name>
        <iban>DE89370400440532013000</iban>
        <account_type>B</account_type>
      </t_to_my_account>
      <location>
        <branch_name>Deutsche Bank Berlin Mitte</branch_name>
        <address>
          <street>Friedrichstraße 50</street>
          <city>Berlin</city>
          <country>DE</country>
        </address>
      </location>
      <description>Cash deposit by client</description>
    </transaction>
    <transaction>
      <t_number>TX-003</t_number>
      <t_date_time>2025-03-23T16:00:00</t_date_time>
      <amount_local>7500.00</amount_local>
      <currency>EUR</currency>
      <t_type>WIRE</t_type>
      <direction>Incoming</direction>
      <t_from>
        <from_account>
          <account_number>CH12345678901234567890</account_number>
          <institution_name>UBS Switzerland AG</institution_name>
          <iban>CH12345678901234567890</iban>
          <account_type>A</account_type>
        </from_account>
      </t_from>
      <t_to_my_client>
        <first_name>Anna</first_name>
        <last_name>Schmidt</last_name>
        <gender>F</gender>
        <nationality>DE</nationality>
        <birth_date>1985-06-15</birth_date>
        <identification>
          <id_number>T123456789</id_number>
          <id_type>O</id_type>
          <issue_country>DE</issue_country>
        </identification>
        <address>
          <street>Hauptstraße 10</street>
          <city>Berlin</city>
          <zip>10115</zip>
          <country>DE</country>
        </address>
        <account_number>DE89370400440532013000</account_number>
      </t_to_my_client>
      <description>Payment received from Swiss entity</description>
    </transaction>
    <activity>
      <activity_id>ACT-2025-0001</activity_id>
      <activity_type>Suspicious Transaction</activity_type>
      <description>Rapid succession of large cross-border transactions and cash deposits involving the same client account, indicating potential money laundering.</description>
      <start_date>2025-03-20</start_date>
      <end_date>2025-03-23</end_date>
      <involved_parties>
        <party>
          <role>Client</role>
          <person>
            <first_name>Anna</first_name>
            <last_name>Schmidt</last_name>
            <gender>F</gender>
            <nationality>DE</nationality>
            <birth_date>1985-06-15</birth_date>
            <identification>
              <id_number>T123456789</id_number>
              <id_type>O</id_type>
              <issue_country>DE</issue_country>
            </identification>
            <address>
              <street>Hauptstraße 10</street>
              <city>Berlin</city>
              <zip>10115</zip>
              <country>DE</country>
            </address>
          </person>
          <account>
            <account_number>DE89370400440532013000</account_number>
            <institution_name>Deutsche Bank AG</institution_name>
            <iban>DE89370400440532013000</iban>
            <account_type>B</account_type>
          </account>
        </party>
        <party>
          <role>Counterparty</role>
          <organization>
            <name>Swiss Trading GmbH</name>
            <registration_number>CHE-123.456.789</registration_number>
            <registration_country>CH</registration_country>
            <address>
              <street>Bahnhofstrasse 25</street>
              <city>Zurich</city>
              <zip>8001</zip>
              <country>CH</country>
            </address>
          </organization>
          <account>
            <account_number>CH12345678901234567890</account_number>
            <institution_name>UBS Switzerland AG</institution_name>
            <iban>CH12345678901234567890</iban>
            <account_type>A</account_type>
          </account>
        </party>
        <party>
          <role>Depositor</role>
          <person>
            <first_name>Unknown</first_name>
            <last_name>Cash Depositor</last_name>
          </person>
        </party>
      </involved_parties>
      <transactions>
        <transaction_ref>TX-001</transaction_ref>
        <transaction_ref>TX-002</transaction_ref>
        <transaction_ref>TX-003</transaction_ref>
      </transactions>
      <indicators>
        <indicator code="A1000">Money laundering</indicator>
        <indicator code="A1001">Transaction in connection with money laundering (FIU approval required, §46 par 1)</indicator>
        <indicator code="A1003">Transaction in connection with money laundering (subsequent finding, §46 par 2)</indicator>
      </indicators>
    </activity>
    <indicators>
      <indicator code="A1000">Money laundering</indicator>
      <indicator code="A1001">Transaction in connection with money laundering (FIU approval required, §46 par 1)</indicator>
      <indicator code="A1003">Transaction in connection with money laundering (subsequent finding, §46 par 2)</indicator>
      <description>Suspicion based on rapid succession of large transactions.</description>
    </indicators>
  </report>
</goaml>`;

    try {
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlString, "text/xml");

      const parserError = xmlDoc.querySelector("parsererror");
      if (parserError) {
        console.error("XML Parsing Error:", parserError.textContent);
        throw new Error("Failed to parse XML");
      }

      const reports = xmlDoc.getElementsByTagName("report");
      console.log("Number of reports found:", reports.length);

      function xmlToJson(xml) {
        const result = {};
        Array.from(xml.childNodes).forEach(node => {
          if (node.nodeType === 1) {
            const key = node.tagName;
            if (node.childNodes.length === 1 && node.childNodes[0].nodeType === 3) {
              result[key] = node.textContent.trim();
            } else {
              const children = xmlToJson(node);
              if (result[key]) {
                if (!Array.isArray(result[key])) {
                  result[key] = [result[key]];
                }
                result[key].push(children);
              } else {
                result[key] = children;
              }
            }
          }
        });
        return result;
      }

      const data = Array.from(reports).map(report => xmlToJson(report));
      console.log("Parsed data:", data);

      function buildTree(data, parentElement) {
        if (!data || data.length === 0) {
          console.error("No data to build tree");
          return;
        }
        data.forEach((report, index) => {
          const li = document.createElement("li");
          li.innerHTML = `<span class="label" data-field="report" data-tooltip="A goAML Suspicious Transaction Report">Report ${report.report_id || index + 1}</span>`;
          li.classList.add("has-children");
          parentElement.appendChild(li);

          const ul = document.createElement("ul");
          ul.classList.add("hidden");
          buildSubTree(report, ul);
          li.appendChild(ul);

          li.addEventListener("click", (e) => {
            e.stopPropagation();
            ul.classList.toggle("hidden");
            li.classList.toggle("open");
          });
        });
      }

      function buildSubTree(obj, parentElement) {
        for (const [key, value] of Object.entries(obj)) {
          const li = document.createElement("li");
          if (typeof value === "object" && !Array.isArray(value)) {
            const fieldInfo = fieldDictionary[key] || { description: "No description available", lookup_values: null };
            li.innerHTML = `<span class="label" data-field="${key}" data-tooltip="${fieldInfo.description}">${key}</span>`;
            li.classList.add("has-children");
            const ul = document.createElement("ul");
            ul.classList.add("hidden");
            buildSubTree(value, ul);
            li.appendChild(ul);

            li.addEventListener("click", (e) => {
              e.stopPropagation();
              ul.classList.toggle("hidden");
              li.classList.toggle("open");
            });

            const label = li.querySelector(".label");
            label.addEventListener("click", (e) => {
              e.stopPropagation();
              const existingLookup = li.querySelector(".lookup-values");
              if (existingLookup) {
                existingLookup.remove();
                return;
              }
              if (fieldInfo.lookup_values) {
                const lookupDiv = document.createElement("div");
                lookupDiv.classList.add("lookup-values");
                const ul = document.createElement("ul");
                fieldInfo.lookup_values.forEach(value => {
                  const li = document.createElement("li");
                  li.textContent = `${value.code}: ${value.description}`;
                  ul.appendChild(li);
                });
                lookupDiv.appendChild(ul);
                li.appendChild(lookupDiv);
                lookupDiv.style.display = "block";
              }
            });
          } else if (Array.isArray(value)) {
            const fieldInfo = fieldDictionary[key] || { description: "No description available", lookup_values: null };
            li.innerHTML = `<span class="label" data-field="${key}" data-tooltip="${fieldInfo.description}">${key}</span>`;
            li.classList.add("has-children");
            const ul = document.createElement("ul");
            ul.classList.add("hidden");
            value.forEach((item, idx) => {
              const itemLi = document.createElement("li");
              itemLi.innerHTML = `<span class="label" data-field="${key}" data-tooltip="${fieldInfo.description}">${key} ${idx + 1}</span>`;
              itemLi.classList.add("has-children");
              const itemUl = document.createElement("ul");
              itemUl.classList.add("hidden");
              buildSubTree(item, itemUl);
              itemLi.appendChild(itemUl);

              itemLi.addEventListener("click", (e) => {
                e.stopPropagation();
                itemUl.classList.toggle("hidden");
                itemLi.classList.toggle("open");
              });

              const itemLabel = itemLi.querySelector(".label");
              itemLabel.addEventListener("click", (e) => {
                e.stopPropagation();
                const existingLookup = itemLi.querySelector(".lookup-values");
                if (existingLookup) {
                  existingLookup.remove();
                  return;
                }
                if (fieldInfo.lookup_values) {
                  const lookupDiv = document.createElement("div");
                  lookupDiv.classList.add("lookup-values");
                  const ul = document.createElement("ul");
                  fieldInfo.lookup_values.forEach(value => {
                    const li = document.createElement("li");
                    li.textContent = `${value.code}: ${value.description}`;
                    ul.appendChild(li);
                  });
                  lookupDiv.appendChild(ul);
                  itemLi.appendChild(lookupDiv);
                  lookupDiv.style.display = "block";
                }
              });

              ul.appendChild(itemLi);
            });
            li.appendChild(ul);

            li.addEventListener("click", (e) => {
              e.stopPropagation();
              ul.classList.toggle("hidden");
              li.classList.toggle("open");
            });

            const label = li.querySelector(".label");
            label.addEventListener("click", (e) => {
              e.stopPropagation();
              const existingLookup = li.querySelector(".lookup-values");
              if (existingLookup) {
                existingLookup.remove();
                return;
              }
              if (fieldInfo.lookup_values) {
                const lookupDiv = document.createElement("div");
                lookupDiv.classList.add("lookup-values");
                const ul = document.createElement("ul");
                fieldInfo.lookup_values.forEach(value => {
                  const li = document.createElement("li");
                  li.textContent = `${value.code}: ${value.description}`;
                  ul.appendChild(li);
                });
                lookupDiv.appendChild(ul);
                li.appendChild(lookupDiv);
                lookupDiv.style.display = "block";
              }
            });
          } else {
            const fieldInfo = fieldDictionary[key] || { description: "No description available", lookup_values: null };
            li.innerHTML = `<span class="label" data-field="${key}" data-tooltip="${fieldInfo.description}">${key}:</span> <span class="value">${value}</span>`;
            
            const label = li.querySelector(".label");
            label.addEventListener("click", (e) => {
              e.stopPropagation();
              const existingLookup = li.querySelector(".lookup-values");
              if (existingLookup) {
                existingLookup.remove();
                return;
              }
              if (fieldInfo.lookup_values) {
                const lookupDiv = document.createElement("div");
                lookupDiv.classList.add("lookup-values");
                const ul = document.createElement("ul");
                fieldInfo.lookup_values.forEach(value => {
                  const li = document.createElement("li");
                  li.textContent = `${value.code}: ${value.description}`;
                  ul.appendChild(li);
                });
                lookupDiv.appendChild(ul);
                li.appendChild(lookupDiv);
                lookupDiv.style.display = "block";
              }
            });
          }
          parentElement.appendChild(li);
        }
      }

      const treeDiv = document.getElementById("tree");
      if (!treeDiv) {
        console.error("Tree div not found in DOM");
        throw new Error("Tree div not found");
      }
      const rootUl = document.createElement("ul");
      buildTree(data, rootUl);
      treeDiv.appendChild(rootUl);
      console.log("Tree rendered successfully");
    } catch (error) {
      console.error("Error rendering tree:", error);
      const treeDiv = document.getElementById("tree");
      treeDiv.innerHTML = `<p style="color: red;">Error rendering report: ${error.message}. Check console for details.</p>`;
    }
  </script>
</body>
</html>
